name: Integration ğŸ”€

on:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
    steps:
      - uses: actions/checkout@v6
      - uses: oven-sh/setup-bun@v2
      - run: bun install
      - run: bun run format
      - run: bun run lint
      - run: bun run coverage
      - uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
      - run: bun run build

  install-test:
    runs-on: ubuntu-latest
    name: "Vite + React"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Install dependencies & Build
        run: |
          bun install
          bun run build:lib

      - name: Create test project & install daleui
        run: |
          mkdir /tmp/test-project && cd /tmp/test-project
          bun create vite@5 . --template react-ts
          bun install
          bun add "$GITHUB_WORKSPACE"

      - name: Add daleui smoke test
        run: |
          cd /tmp/test-project
          mkdir -p src/smoke
          cat > src/smoke/DaleTest.tsx << 'EOF'
          import { Button } from 'daleui';

          export default function DaleTest() {
            return (
              <div data-testid="daleui-smoke">
                <Button>daleui ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨!</Button>
              </div>
            );
          }
          EOF

      - name: Run production build
        run: |
          cd /tmp/test-project
          bun run build
